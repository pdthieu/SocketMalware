import socket
from tkinter import *
from tkinter import messagebox

list_process = []

def close_process(s, ID):
    request = 'kill process'
    try:
        s.sendall(bytes(request, 'utf8'))
        s.sendall(bytes(ID.get(), 'utf8'))
        ID.delete(0, END)
        messagebox.showinfo('', 'Killed process!')
    except:
        messagebox.showinfo('', "Can't kill !")

def kill_process(s):
    root2 = Tk()
    root2.title('Kill')
    root2.geometry('300x50')
    id = Entry(root2)
    id.place(relx=0.05, rely=0.3, relwidth=0.6, relheight=0.4)
    id.insert(0, 'Enter ID')
    
    Button(root2, text = 'Kill', command=lambda: close_process(s, id)).place(relx=0.7, rely=0.3, relwidth=0.25, relheight=0.4)
    root2.mainloop()
    pass

def receivedListProcess(s):
    global list_process
    list_process.clear()
    while True:
        data = s.recv(4096).decode('utf8')
        if data == 'done':
            break
        list_process.append(data)
    return list_process

def watch_process(s, lb):
    global list_process

    request = 'watch process'
    s.sendall(bytes(request, 'utf8'))
    receivedListProcess(s)
    #data = ['1', '2', '3']
    lb.delete(0, END)
    for x in list_process:
        lb.insert(END, x)
    pass

def delete_process(s, lb):
    global list_process
    list_process.clear()
    lb.delete(0, END)
    pass

def open_process(s, ID):
    request = 'start process'
    try:
        s.sendall(bytes(request, 'utf8'))
        s.sendall(bytes(ID, 'utf8'))
        id.delete(0, END)
        messagebox.showinfo('', 'Successful open application!')
    except:
        messagebox.showinfo('', 'Opened application!')
    pass

def start_process(s):
    root2 = Tk()
    root2.title('Start')
    root2.geometry('300x50')
    name_process = Entry(root2)
    name_process.place(relx=0.05, rely=0.3, relwidth=0.6, relheight=0.4)
    name_process.insert(0, "Enter name's process")
    Button(root2, text = 'Start', command=lambda: open_process(s, name_process.get())).place(relx=0.7, rely=0.3, relwidth=0.25, relheight=0.4)
    root2.mainloop()
    pass

def process_running(s):
    request = 'ProcessRunning'
    #s.sendall(bytes(request, 'utf8'))
    root = Tk()
    root.title('Process')
    root.geometry('400x400')

    global list_process

    my_scrollbar = Scrollbar(root, orient=VERTICAL)

    lb = Listbox(root, yscrollcommand=my_scrollbar.set)
    lb.place(relx=0.04, rely=0.2, relwidth=0.87, relheight=0.7)

    my_scrollbar.config(command=lb.yview)
    my_scrollbar.place(relx=0.91, rely=0.2, relwidth=0.05, relheight=0.7)

    Button(root, text='Kill', command=lambda: kill_process(s)).place(relx=0.04, rely=0.05, relwidth=0.2, relheight=0.1)
    Button(root, text='Watch', command=lambda: watch_process(s, lb)).place(relx=0.28, rely=0.05, relwidth=0.2, relheight=0.1)
    Button(root, text='Start', command=lambda: start_process(s)).place(relx=0.52, rely=0.05, relwidth=0.2, relheight=0.1)
    Button(root, text='Delete', command=lambda: delete_process(s, lb)).place(relx=0.76, rely=0.05, relwidth=0.2, relheight=0.1) 
    
    root.mainloop()
    pass
