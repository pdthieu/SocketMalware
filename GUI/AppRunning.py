import socket
from tkinter import *
from tkinter import messagebox

list_app = []

def close_app(s, ID):
    request = 'kill application'
    try:
        s.sendall(bytes(request, 'utf8'))
        s.sendall(bytes(ID.get(), 'utf8'))
        ID.delete(0, END)
        messagebox.showinfo('', 'Killed appplication!')
    except:
        messagebox.showinfo('', "Can't kill !")

def kill_app(s):
    root2 = Tk()
    root2.title('Kill')
    root2.geometry('300x50')
    id = Entry(root2)
    id.place(relx=0.05, rely=0.3, relwidth=0.6, relheight=0.4)
    id.insert(0, 'Enter ID')
    
    Button(root2, text = 'Kill', command=lambda: close_app(s, id)).place(relx=0.7, rely=0.3, relwidth=0.25, relheight=0.4)
    root2.mainloop()
    pass

def receivedListapp(s):
    global list_app
    list_app.clear()
    while True:
        data = s.recv(4096).decode('utf8')
        if data == 'done':
            break
        list_app.append(data)
    return list_app

def watch_app(s, lb):
    global list_app

    request = 'watch application'
    s.sendall(bytes(request, 'utf8'))
    receivedListapp(s)
    #data = ['1', '2', '3']
    lb.delete(0, END)
    for x in list_app:
        lb.insert(END, x)
    pass

def delete_app(s, lb):
    global list_app
    list_app.clear()
    lb.delete(0, END)
    pass

def open_app(s, ID):
    request = 'start app'
    try:
        s.sendall(bytes(request, 'utf8'))
        s.sendall(bytes(ID, 'utf8'))
        id.delete(0, END)
        messagebox.showinfo('', 'Successful open application!')
    except:
        messagebox.showinfo('', 'Opened application!')
    pass

def start_app(s):
    root2 = Tk()
    root2.title('Start')
    root2.geometry('300x50')
    name_app = Entry(root2)
    name_app.place(relx=0.05, rely=0.3, relwidth=0.6, relheight=0.4)
    name_app.insert(0, "Enter name's application")
    Button(root2, text = 'Start', command=lambda: open_app(s, name_app.get())).place(relx=0.7, rely=0.3, relwidth=0.25, relheight=0.4)
    root2.mainloop()
    pass

def app_running(s):
    '''global check_connect
    if check_connect == False:
        messagebox.showinfo('', "Can't connect sever")
        pass'''
    request = 'app running'
    #s.sendall(bytes(request, 'utf8'))
    root = Tk()
    root.title('Application')
    root.geometry('400x300')

    global list_app

    my_scrollbar = Scrollbar(root, orient=VERTICAL)

    lb = Listbox(root, yscrollcommand=my_scrollbar.set)
    lb.place(relx=0.04, rely=0.2, relwidth=0.87, relheight=0.7)

    my_scrollbar.config(command=lb.yview)
    my_scrollbar.place(relx=0.91, rely=0.2, relwidth=0.05, relheight=0.7)

    Button(root, text='Kill', command=lambda: kill_app(s)).place(relx=0.04, rely=0.05, relwidth=0.2, relheight=0.1)
    Button(root, text='Watch', command=lambda: watch_app(s, lb)).place(relx=0.28, rely=0.05, relwidth=0.2, relheight=0.1)
    Button(root, text='Start', command=lambda: start_app(s)).place(relx=0.52, rely=0.05, relwidth=0.2, relheight=0.1)
    Button(root, text='Delete', command=lambda: delete_app(s, lb)).place(relx=0.76, rely=0.05, relwidth=0.2, relheight=0.1) 
    
    root.mainloop()
    pass
